# Deployment workflow on firebase emulators locally

npm run emu 2>&1 | tee emu_output.log &

EMU_PID=$!

while true; do
HOSTING_URL=$(grep -o "Local server: http://[0-9.]\+:[0-9]\+" emu_output.log | sed 's/Local server: //')

if [ -n "$HOSTING_URL" ]; then
echo "Hosting URL detected: $HOSTING_URL"
break
fi

sleep 1
done

wait-on $HOSTING_URL
export BASE_URL=$HOSTING_URL
npm run test

kill EMU_PID
